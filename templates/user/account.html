{% extends "base.html" %}

{% block title %}User Account{% endblock %}

{% block content %}
<style>
  .account-container {
    display: flex;
    gap: 30px;
    margin-top: 40px;
  }

  /* Sidebar */
  .sidebar {
    flex: 0 0 220px;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    background-color: #fafafa;
    font-family: Arial, sans-serif;
  }

  .sidebar button {
    display: block;
    width: 100%;
    margin-bottom: 12px;
    padding: 12px 15px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    color: #333;
    cursor: pointer;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    text-align: left;
  }

  .sidebar button:hover {
    background-color: #f54a00;
    color: white;
    border-color: #f54a00;
  }

  .sidebar button.active {
    background-color: #f54a00;
    color: white;
    border-color: #f54a00;
    font-weight: 600;
  }

  /* Content area */
  .content-area {
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 25px;
    font-family: Arial, sans-serif;
    background-color: white;
    min-height: 400px;
  }

  .content-area h3 {
    margin-bottom: 20px;
    color: #f54a00;
  }

  /* Table for order details */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  table th, table td {
    padding: 10px 12px;
    border: 1px solid #ddd;
    text-align: left;
  }

  table th {
    background-color: #f54a00;
    color: white;
  }

</style>

<div class="container">
  <h2>Welcome, {{ user_name }}!</h2>

  <div class="account-container" style="display: flex;">
    <div class="sidebar" style="min-width: 200px; margin-right: 20px;">
      <button class="sidebar-btn active" data-section="account-details">Account Details</button>
      <button class="sidebar-btn" data-section="order-details">Order Details</button>
      <button class="sidebar-btn" data-section="change-password">Change Password</button>
      <button class="sidebar-btn" data-section="address-book">Address Book</button>
      <button class="sidebar-btn" data-section="logout-section">Logout</button>
    </div>

    <div class="content-area" style="flex-grow: 1;">
      <section id="account-details" class="account-section">
        <h3>Account Details</h3>
        <p><strong>Name:</strong> {{ user_name }}</p>
        <p><strong>Email:</strong> {{ user_email }}</p>
        <p><strong>Mobile:</strong> {{ user_mobile }}</p>
        <p><strong>Profession:</strong> {{ user_profession }}</p>
        <p><strong>Account Created On:</strong> {{ user_created }}</p>
      </section>
<section id="order-details" class="account-section" style="display:none;">
  <h3>Order Details</h3>
  {% if orders %}
    {% set steps = ['pending', 'processing', 'product_at_courier', 'product_at_warehouse', 'ready_for_delivery', 'received'] %}
    {% for order in orders %}
      <div class="order-card" style="margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
        <p><strong>Order Date:</strong> {{ order.order_date.strftime('%Y-%m-%d') }}</p>
        <p><strong>Shipping Address:</strong> {{ order.shipping_address }}</p>
        <p><strong>Payment Method:</strong> {{ order.payment_method|capitalize }}</p>
        <p><strong>Total Categories:</strong> {{ order.total_categories }}</p>
        <p><strong>Total Quantity:</strong> {{ order.total_quantity }}</p>
        <p><strong>Total Price:</strong> ${{ "%.2f"|format(order.total_price) }}</p>

        {% set status = order.order_status.lower().replace(' ', '_') %}
        {% set current_index = steps.index(status) if status in steps else 0 %}

        <div class="status-steps" style="display: flex; gap: 10px; margin-top: 15px;">
          {% for step in steps %}
            {% set step_index = loop.index0 %}
            <div class="step
              {% if step == status %}
                active-step
              {% elif step_index < current_index %}
                completed-step
              {% else %}
                upcoming-step
              {% endif %}
            " style="flex: 1; padding: 8px; text-align: center; border-radius: 5px; font-weight: bold; cursor: default; position: relative; display: flex; align-items: center; justify-content: center;">

              {{ step.replace('_', ' ').capitalize() }}

              {% if step_index < current_index %}
                <span class="icon" style="color: green; margin-left: 5px;">✔️</span>
{% elif step_index == current_index %}
    {% if step == 'received' %}
        <span style="color: white; margin-left: 5px;">✔</span>
            {% else %}
                    <!-- Static progress bar with moving ✈️ -->
                    <div class="progress-bar-container" style="position: absolute; bottom: 0px; left: 0; right: 0px; height: 100%;">
                    <span class="moving-truck">✈️</span>
                    </div>
                {% endif %}
            {% endif %}

            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>You have no orders yet.</p>
  {% endif %}
</section>

<style>
  .active-step {
    background-color: #4caf50;
    color: white;
  }
  .completed-step {
    background-color: #a5d6a7;
    color: #2e7d32;
    filter: none;
  }
  .upcoming-step {
    background-color: #e0e0e0;
    color: #9e9e9e;
    filter: blur(1.3px);
  }

  .progress-bar-container {
    position: relative;
    overflow: hidden;
  }

.moving-truck {
  position: absolute;
  top: 25px; 
  left: -30px;
  font-size: 20px;
  animation: truck-move 12s linear infinite;
  transform: rotate(30deg); 
  transform-origin: center bottom;
}


  @keyframes truck-move {
    0% {
      left: -30px;
    }
    100% {
      left: 100%;
    }
  }
</style>

      <section id="change-password" class="account-section" style="display:none;">
        <h3>Change Password</h3>
        <p>এখানে পাসওয়ার্ড পরিবর্তনের ফর্ম আসবে।</p>
      </section>

      <section id="address-book" class="account-section" style="display:none;">
        <h3>Address Book</h3>
        <p>এখানে ইউজারের ঠিকানাগুলোর তালিকা দেখাবে।</p>
      </section>

      <section id="logout-section" class="account-section" style="display:none;">
        <h3>Logout</h3>
        <p>আপনি কি লগআউট করতে চান?</p>
        <a href="{{ url_for('logout') }}" class="btn btn-danger">Yes, Logout</a>
        <button class="btn btn-secondary" id="cancel-logout">Cancel</button>
      </section>
    </div>
  </div>
</div>

<script>
  const buttons = document.querySelectorAll('.sidebar-btn');
  const sections = document.querySelectorAll('.account-section');
  
  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      const target = btn.getAttribute('data-section');
      
      sections.forEach(sec => {
        if (sec.id === target) {
          sec.style.display = 'block';
        } else {
          sec.style.display = 'none';
        }
      });
    });
  });

  // Cancel logout button behavior
  document.getElementById('cancel-logout').addEventListener('click', () => {
    // Show previous active section (e.g. account-details)
    document.querySelector('.sidebar-btn.active').classList.remove('active');
    const defaultBtn = document.querySelector('.sidebar-btn[data-section="account-details"]');
    defaultBtn.classList.add('active');

    sections.forEach(sec => {
      if (sec.id === 'account-details') {
        sec.style.display = 'block';
      } else {
        sec.style.display = 'none';
      }
    });
  });
</script>

{% endblock %}
